var crop=function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();return function(){function n(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,n),this.width=i.width||400,this.height=i.height||400,this.quality=i.quality||.8,this.success=i.success,this.style();this.layout=document.createElement("DIV"),this.layout.classList.add("crop"),this.layout.classList.add("active"),this.layout.innerHTML='\n        <div class="crop-wall">\n            <img class="crop-image">\n        </div>\n        <div class="crop-mask"></div>\n        <input class="crop-zoom" type="range" value="100" min="100" max="200" step="1">\n        <div class="crop-file">\n            <input type="file" accept="image/*">\n            <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 1024 1024">\n                <path fill="#fff"\n                    d="M53.039687 176.551724 375.098244 176.551724C374.484286 176.551724 473.585858 291.710552 473.585858 291.710552 486.581177 307.112413 509.433838 317.793103 529.530968 317.793103L971.158687 317.793103C961.315964 317.793103 953.37931 309.775113 953.37931 300.309822L953.37931 882.58673C953.37931 872.955622 961.207896 865.103448 970.914322 865.103448L53.085678 865.103448C62.785907 865.103448 70.62069 872.915968 70.62069 882.765489L70.62069 158.889684C70.62069 168.590089 62.665481 176.551724 53.039687 176.551724ZM0 882.765489C0 911.963754 23.828092 935.724138 53.085678 935.724138L970.914322 935.724138C1000.258278 935.724138 1024 911.910877 1024 882.58673L1024 300.309822C1024 270.932674 1000.480803 247.172414 971.158687 247.172414L529.530968 247.172414C530.299604 247.172414 431.241728 132.013586 431.241728 132.013586 418.224358 116.585578 395.290394 105.931034 375.098244 105.931034L53.039687 105.931034C23.649986 105.931034 0 129.600124 0 158.889684L0 882.765489Z" />\n            </svg>\n        </div>\n        <div class="crop-close"></div>\n        <div class="crop-ok">OK</div>\n        ',document.querySelector("body").appendChild(this.layout),this.input=document.querySelector(i.input||".crop-file"),this.crop=document.querySelector(i.crop||".crop"),this.cropWall=document.querySelector(i.wall||".crop-wall"),this.cropImage=document.querySelector(i.image||".crop-image"),this.cropClose=document.querySelector(i.close||".crop-close"),this.cropOk=document.querySelector(i.ok||".crop-ok"),this.cropZoom=document.querySelector(i.zoom||".crop-zoom"),this.crop.style.width=this.width+"px",this.crop.style.height=this.height+"px",this.cropWall.style.width=this.width+"px",this.cropWall.style.height=this.height+"px",this.input.addEventListener("change",function(t){if(e.files=t.target.files||t.dataTransfer.files,0==e.files.length)return!1;e.getOrientation(e.files[0],function(t){e.orientation=t;var n=new FileReader;n.onload=function(t){e.open(e.dataURLtoBlob(t.target.result))},n.readAsDataURL(e.files[0])})}),void 0!=i.url&&this.open(i.url),this.cropClose.addEventListener("click",function(){e.layout.parentNode.removeChild(e.layout)}),this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.setAttribute("style","position:absolute;left:0;top:0;opacity:0;pointer-events:none;"),this.context=this.canvas.getContext("2d"),this.layout.appendChild(this.canvas)}return e(n,[{key:"style",value:function(){if(!document.querySelector("#cropStyle")){var t='\n            .crop {\n                position: absolute;\n                left: 50%;\n                top: 50%;\n                transform: translate3d(-50%, -50%, 0);\n                width: 400px;\n                height: 400px;\n                background: #000;\n                box-shadow: 0 0 20px 2px rgba(0, 0, 0, .5);\n                z-index: 20;\n                transition: all .2s cubic-bezier(0.99, 0.01, 0.22, 0.94);\n            }\n\n            .crop.loading::after {\n                content: "LOADING";\n                position: absolute;\n                left: 0;\n                right: 0;\n                top: 0;\n                bottom: 0;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 10px;\n                background-color: rgba(0, 0, 0, .5);\n                color: #666;\n            }\n\n            .crop-wall {\n                position: relative;\n                height: 100%;\n                overflow: hidden;\n            }\n            .crop-wall img{\n                user-select:none;\n            }\n            .crop-mask{\n                pointer-events:none;\n                position:absolute;\n                left:0;\n                right:0;\n                top:0;\n                bottom:0;\n            }\n            .crop-mask::before{\n                content:"";\n                position:absolute;\n                left:0;\n                right:0;\n                top:0;\n                height:120px;\n                background-image: linear-gradient(0deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%);\n            }\n            .crop-mask::after{\n                content:"";\n                position:absolute;\n                left:0;\n                right:0;\n                bottom:0;\n                height:120px;\n                background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%);\n            }\n            .crop-file {\n                position: absolute;\n                left: 15px;\n                top: 15px;\n                transition: .3s;\n                cursor: pointer;\n            }\n\n            .crop-file:hover {\n                transform: scale(1.2);\n            }\n\n            .crop-file svg {\n                width: 22px;\n                height: 22px;\n            }\n\n            .crop-file input {\n                position: absolute;\n                width: 100%;\n                height: 100%;\n                opacity: 0;\n                cursor: pointer;\n            }\n\n            .crop.active .crop-file {\n                position: absolute;\n                left: 50%;\n                top: 50%;\n                transform: translate(-50%, -50%);\n                transition: 0s;\n            }\n\n            .crop.loading .crop-file {\n                opacity: 0;\n\n            }\n\n            .crop.active .crop-file svg {\n                width: 50px;\n                height: 50px;\n            }\n\n            .crop.active .crop-file svg path {\n                fill: #333;\n            }\n\n            .crop-ok {\n                position: absolute;\n                right: 10px;\n                bottom: 10px;\n                width: 66px;\n                height: 26px;\n                border-radius: 40px;\n                text-align: center;\n                font-size: 10px;\n                font-family: arial;\n                line-height: 26px;\n                border: 2px solid #fff;\n                color: #fff;\n                transition: all .2s ease-in-out;\n                cursor: pointer;\n                opacity: 0;\n            }\n\n            .crop-ok.show {\n                opacity: 1;\n            }\n\n            .crop-ok:hover {\n                background-color: rgba(255, 255, 255, 0.2);\n            }\n\n            .crop-close {\n                position: absolute;\n                top: 15px;\n                right: 15px;\n                width: 30px;\n                height: 30px;\n                cursor: pointer;\n                transition: .3s;\n                transform: scale(0.8);\n            }\n\n            .crop-close:hover {\n                transform: scale(1);\n            }\n\n            .crop-close:before {\n                position: absolute;\n                content: \'\';\n                width: 30px;\n                height: 2px;\n                background: white;\n                transform: rotate(45deg);\n                top: 14px;\n                left: 0px;\n                border-radius: 2px;\n            }\n\n            .crop-close:after {\n                content: \'\';\n                position: absolute;\n                width: 30px;\n                height: 2px;\n                background: white;\n                transform: rotate(-45deg);\n                top: 14px;\n                left: 0px;\n                border-radius: 2px;\n            }\n\n            .crop-zoom {\n                position: absolute;\n                left: 10px;\n                bottom: 20px;\n                width: 100px;\n                opacity: 0;\n                transition: .3s;\n            }\n\n            .crop-zoom.show {\n                opacity: 1;\n            }\n\n            input[type=range] {\n                -webkit-appearance: none;\n\n            }\n\n            input[type=range]:focus {\n                outline: none;\n            }\n\n            input[type=range]::-webkit-slider-runnable-track {\n                width: 100%;\n                height: 2px;\n                border-radius: 2px;\n                background: #fff;\n                border: none;\n\n            }\n\n            input[type=range]::-webkit-slider-thumb {\n                height: 16px;\n                width: 16px;\n                border-radius: 10px;\n                background: #fff;\n                cursor: pointer;\n                -webkit-appearance: none;\n                margin-top: -8px;\n                transition: .3s;\n            }\n\n            input[type=range]::-webkit-slider-thumb:hover {\n                transform: scale(1.2);\n            }\n\n            input[type=range]::-moz-range-track {\n                width: 100%;\n                height: 2px;\n                background: #000;\n            }\n\n            input[type=range]::-moz-range-thumb {\n                height: 16px;\n                width: 16px;\n                border-radius: 8px;\n                border: 2px solid #efb708;\n                background: #ffffff;\n                cursor: pointer;\n            }\n\n            input[type=range]::-ms-track {\n                width: 100%;\n                height: 1px;\n                cursor: pointer;\n                background: transparent;\n                border-color: transparent;\n                color: transparent;\n            }\n\n            input[type=range]::-ms-fill-lower {\n                background: rgba(0, 0, 0, 0.5);\n                border: 0px solid rgba(200, 200, 200, 0.2);\n                border-radius: 0px;\n                box-shadow: 0px 0px 0px rgba(0, 0, 0, 0), 0px 0px 0px rgba(13, 13, 13, 0);\n            }\n\n            input[type=range]::-ms-fill-upper {\n                background: rgba(0, 0, 0, 0.5);\n                border: 0px solid rgba(200, 200, 200, 0.2);\n                border-radius: 0px;\n                box-shadow: 0px 0px 0px rgba(0, 0, 0, 0), 0px 0px 0px rgba(13, 13, 13, 0);\n            }\n\n            input[type=range]::-ms-thumb {\n                height: 16px;\n                width: 16px;\n                border-radius: 8px;\n                background: #ffffff;\n                cursor: pointer;\n                height: 1px;\n            }\n\n            input[type=range]:focus::-ms-fill-lower {\n                background: rgba(0, 0, 0, 0.5);\n            }\n\n            input[type=range]:focus::-ms-fill-upper {\n                background: rgba(0, 0, 0, 0.5);\n            }\n        ',e=document.createElement("style");e.type="text/css",e.id="cropStyle",e.styleSheet?e.styleSheet.cssText=t.replace(/\s/,""):e.innerHTML=t.replace(/\s/,""),document.getElementsByTagName("head")[0].appendChild(e)}}},{key:"open",value:function(t){var e=this,n=this;this.isMobile=/ios|android/.test(navigator.userAgent.toLowerCase()),this.beginX=0,this.beginY=0,this.scaleX=0,this.scaleY=0,this.scaleHeight=0,this.scaleWidth=0,this.isDrag=!1,this.crop.classList.add("loading"),this.img=new Image,this.img.crossOrigin="anonymous",this.img.onload=function(){if(e.crop.classList.remove("loading"),e.crop.classList.remove("active"),e.cropZoom.classList.add("show"),e.cropOk.classList.add("show"),e.temp={width:e.img.naturalWidth,height:e.img.naturalHeight},6==e.orientation&&(e.temp.width=e.img.naturalHeight,e.temp.height=e.img.naturalWidth),e.temp.width>e.temp.height?(e.scaleHeight=e.height,e.scaleWidth=Math.round(e.scaleHeight*e.temp.width/e.temp.height)):(e.scaleWidth=e.width,e.scaleHeight=Math.round(e.scaleWidth*e.temp.height/e.temp.width)),e.scaleX=-Math.round((e.scaleWidth-e.width)/2),e.scaleY=-Math.round((e.scaleHeight-e.height)/2),6==e.orientation?e.fixedOrientation(e.img,e.temp.width,e.temp.height,function(t){e.cropImage.setAttribute("src",t)}):e.cropImage.setAttribute("src",t),e.crop.style.width=e.width+"px",e.crop.style.height=e.height+"px",e.cropWall.style.width=e.width+"px",e.cropWall.style.height=e.height+"px",e.cropImage.style.position="absolute",e.cropImage.style.left=e.scaleX+"px",e.cropImage.style.top=e.scaleY+"px",e.cropImage.style.width=e.scaleWidth+"px",e.cropImage.style.height=e.scaleHeight+"px",e.cropImage.style.userSelect="none",e.cropZoom.value=100,e.cropCanvas(),!e.hasEvent){var i=function(){var t=e.canvas.toDataURL("image/jpeg",e.quality);e.success&&e.success(t.substr(23)),e.layout.parentNode.removeChild(e.layout)};e.cropZoom.addEventListener("input",function(t){n.zoom(t)}),e.cropOk.addEventListener("click",i),e.cropImage.addEventListener(n.isMobile?"touchstart":"mousedown",function(t){t.preventDefault(),n.isDrag=!0,n.beginX=t.pageX-t.target.offsetLeft,n.beginY=t.pageY-t.target.offsetTop;var e=function(t){if(!n.isDrag)return!1;n.isMobile?2==t.touches.length?(n.scaleLength=n.touchData(t).length,n.scale=Math.min(200,Math.max(100,n.scaleLength/n.beginLength*100)),this.zoom()):(n.scaleX=t.pageX-beginX,n.scaleY=t.pageY-beginY):(n.scaleX=t.pageX-n.beginX,n.scaleY=t.pageY-n.beginY),n.limit(),n.cropImage.style.width=n.scaleWidth+"px",n.cropImage.style.height=n.scaleHeight+"px",n.cropImage.style.left=n.scaleX+"px",n.cropImage.style.top=n.scaleY+"px"},i=function t(i){n.isDrag=!1,n.isMobile?(document.removeEventListener("touchmove",e,!1),document.removeEventListener("touchend",t,!1)):(document.removeEventListener("mousemove",e,!1),document.removeEventListener("mouseup",t,!1))};n.isMobile?(2==t.touches.length&&(n.beginLength=0==n.beginLength?n.touchData(t).length:n.beginLength),document.addEventListener("touchmove",e),document.addEventListener("touchend",i)):(document.addEventListener("mousemove",e),document.addEventListener("mouseup",i))}),e.hasEvent=!0}},this.img.src=t}},{key:"cropCanvas",value:function(){this.context.clearRect(0,0,this.width,this.height);var t=Math.round(Math.abs(this.scaleX)*this.img.naturalWidth/this.scaleWidth),e=Math.round(Math.abs(this.scaleY)*this.img.naturalHeight/this.scaleHeight),n=this.width*this.img.naturalWidth/this.scaleWidth>>0,i=this.height*this.img.naturalHeight/this.scaleHeight>>0;this.context.drawImage(this.img,t,e,n,i,0,0,this.width,this.height/this.cropRatio())}},{key:"cropRatio",value:function(){var t=(this.img.naturalWidth,this.img.naturalHeight),e=document.createElement("canvas");e.width=1,e.height=t;var n=e.getContext("2d");n.drawImage(this.img,0,0);for(var i=n.getImageData(0,0,1,t).data,o=0,a=t,s=t;s>o;){0===i[4*(s-1)+3]?a=s:o=s,s=a+o>>1}var r=s/t;return 0===r?1:r}},{key:"getOrientation",value:function(t,e){var n=new FileReader;n.onload=function(t){var n=new DataView(t.target.result);if(65496!=n.getUint16(0,!1))return e(-2);for(var i=n.byteLength,o=2;o<i;){var a=n.getUint16(o,!1);if(o+=2,65505==a){if(1165519206!=n.getUint32(o+=2,!1))return e(-1);var s=18761==n.getUint16(o+=6,!1);o+=n.getUint32(o+4,s);var r=n.getUint16(o,s);o+=2;for(var h=0;h<r;h++)if(274==n.getUint16(o+12*h,s))return e(n.getUint16(o+12*h+8,s))}else{if(65280!=(65280&a))break;o+=n.getUint16(o,!1)}}return e(-1)},n.readAsArrayBuffer(t.slice(0,65536))}},{key:"fixedOrientation",value:function(t,e,n,i){var o,a;o=document.createElement("canvas"),o.width=e,o.height=n,a=o.getContext("2d"),6==this.orientation?(a.save(),a.translate(e/2,n/2),a.rotate(90*Math.PI/180),a.drawImage(t,0-n/2,0-e/2,n,e),a.restore()):a.drawImage(t,0,0,e,n),o.toBlob(function(t){var e=URL.createObjectURL(t);i&&i(e)})}},{key:"zoom",value:function(t){var e=parseInt(t.target.value)/100,n=this.scaleX-this.width/2,i=this.scaleY-this.height/2,o=void 0;this.temp.width>this.temp.height?(o=this.scaleHeight/this.height,this.scaleHeight=this.height*e,this.scaleWidth=this.scaleHeight*this.temp.width/this.temp.height):(o=this.scaleWidth/this.width,this.scaleWidth=this.width*e,this.scaleHeight=this.scaleWidth*this.temp.height/this.temp.width),this.scaleX=n*e/o+this.width/2,this.scaleY=i*e/o+this.height/2,this.limit(),this.cropCanvas(),this.cropImage.style.width=this.scaleWidth+"px",this.cropImage.style.height=this.scaleHeight+"px",this.cropImage.style.left=this.scaleX+"px",this.cropImage.style.top=this.scaleY+"px"}},{key:"limit",value:function(){this.scaleX<-(this.scaleWidth-this.width)&&(this.scaleX=-(this.scaleWidth-this.width)),this.scaleY<-(this.scaleHeight-this.height)&&(this.scaleY=-(this.scaleHeight-this.height)),this.scaleX>0&&(this.scaleX=0),this.scaleY>0&&(this.scaleY=0),this.scaleHeight===this.height&&(this.scaleY=0),this.scaleWidth===this.width&&(this.scaleX=0)}},{key:"touchData",value:function(t){if(!(t.touches.length<2)){var e=t.touches[0].pageX,n=t.touches[1].pageX,i=e<=n?(n-e)/2+e:(e-n)/2+n,o=t.touches[0].pageY-this.scrollbar.scrollTop,a=t.touches[1].pageY-this.scrollbar.scrollTop,s=o<=a?(a-o)/2+o:(o-a)/2+a;return{length:Math.round(Math.sqrt(Math.pow(e-n,2)+Math.pow(o-a,2))),x:Math.round(i),y:Math.round(s)}}}},{key:"dataURLtoBlob",value:function(t){for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],i=atob(e[1]),o=i.length,a=new Uint8Array(o);o--;)a[o]=i.charCodeAt(o);return URL.createObjectURL(new Blob([a],{type:n}))}}]),n}()}();
